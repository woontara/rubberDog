<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>설정 - RubberDog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .settings-section {
            padding: 30px;
        }

        .setting-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .setting-group h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        .setting-item label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .setting-item input[type="text"],
        .setting-item input[type="number"],
        .setting-item select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .setting-item input:focus,
        .setting-item select:focus {
            outline: none;
            border-color: #667eea;
        }

        .setting-item .description {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e1e5e9;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d1d5d9;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .api-key-input {
            position: relative;
        }

        .api-key-input input {
            padding-right: 100px;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 13px;
            padding: 5px 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 사이드바 -->
    <style>
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-logo {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 16px;
        }

        .sidebar-menu a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .sidebar-menu a.active {
            background: rgba(255,255,255,0.3);
            font-weight: 600;
        }

        .sidebar-menu a .icon {
            margin-right: 10px;
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
        }
    </style>

    <div class="sidebar">
        <div class="sidebar-logo">🎬 RubberDog</div>
        <ul class="sidebar-menu">
            <li><a href="/index.html"><span class="icon">🏠</span><span>홈</span></a></li>
            <li><a href="/channels.html"><span class="icon">📋</span><span>채널 목록</span></a></li>
            <li><a href="/videos.html"><span class="icon">📺</span><span>영상 목록</span></a></li>
            <li><a href="/results.html"><span class="icon">📝</span><span>결과 목록</span></a></li>
            <li><a href="/settings.html" class="active"><span class="icon">⚙️</span><span>설정</span></a></li>
        </ul>
    </div>

    <div class="main-content">
    <div class="container">
        <div class="header">
            <h1>⚙️ 설정</h1>
            <p>RubberDog 시스템 설정 및 관리</p>
        </div>

        <div class="settings-section">
            <!-- 자막 수집 설정 -->
            <div class="setting-group">
                <h2>📝 자막 수집 설정</h2>

                <div class="setting-item">
                    <label>자동 수집 활성화</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-collect" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="description">Cron Job을 통한 자동 자막 수집 활성화/비활성화</div>
                </div>

                <div class="setting-item">
                    <label>수집 주기</label>
                    <select id="collect-interval">
                        <option value="6">6시간마다</option>
                        <option value="12" selected>12시간마다</option>
                        <option value="24">24시간마다</option>
                    </select>
                    <div class="description">자막 자동 수집 주기</div>
                </div>

                <div class="setting-item">
                    <label>최소 자막 수집 목표</label>
                    <input type="number" id="min-subtitle-target" value="10" min="1" max="100">
                    <div class="description">한 번 실행시 수집할 최소 자막 개수</div>
                </div>
            </div>

            <!-- 채널 수집 설정 -->
            <div class="setting-group">
                <h2>🎥 채널 수집 설정</h2>

                <div class="setting-item">
                    <label>채널 검색 키워드</label>
                    <input type="text" id="search-keywords" value="한국 여행, 여행 브이로그, 해외여행" placeholder="쉼표로 구분">
                    <div class="description">채널 검색에 사용할 키워드 (쉼표로 구분)</div>
                </div>

                <div class="setting-item">
                    <label>채널 수집 제한</label>
                    <input type="number" id="channel-limit" value="50" min="10" max="200">
                    <div class="description">최대 수집할 채널 개수</div>
                </div>
            </div>

            <!-- 블로그 생성 설정 -->
            <div class="setting-group">
                <h2>✍️ 블로그 생성 설정</h2>

                <div class="setting-item">
                    <label>Claude AI 모델 선택</label>
                    <div class="description" style="margin-bottom: 10px;">
                        블로그 글 생성에 사용할 Claude AI 모델을 선택합니다.<br>
                        최신 모델일수록 성능이 좋지만 비용이 높을 수 있습니다.
                    </div>
                    <select id="claude-model" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;">
                        <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (최신, 추천)</option>
                        <option value="claude-3-5-sonnet-20240620">Claude 3.5 Sonnet (2024-06)</option>
                        <option value="claude-3-opus-20240229">Claude 3 Opus (최고 품질)</option>
                        <option value="claude-3-sonnet-20240229">Claude 3 Sonnet (균형)</option>
                        <option value="claude-3-haiku-20240307">Claude 3 Haiku (빠르고 저렴)</option>
                    </select>
                    <div style="margin-top: 8px; padding: 10px; background-color: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px; font-size: 13px;">
                        <strong>💡 모델 선택 가이드:</strong><br>
                        • <strong>Sonnet 3.5</strong>: 균형잡힌 성능, 대부분의 경우 추천<br>
                        • <strong>Opus</strong>: 최고 품질, 복잡한 글 작성 시 사용<br>
                        • <strong>Haiku</strong>: 빠른 응답, 간단한 글 작성 시 사용
                    </div>
                </div>

                <div class="setting-item">
                    <label>블로그 프롬프트 템플릿</label>
                    <div class="description" style="margin-bottom: 10px;">
                        AI가 블로그 글을 작성할 때 사용할 프롬프트를 설정합니다.<br>
                        비워두면 기본 템플릿(여행 블로그 전문 작가)이 사용됩니다.
                    </div>
                    <textarea
                        id="blog-prompt-template"
                        rows="10"
                        placeholder="예시:&#10;당신은 여행 블로그 전문 작가입니다.&#10;&#10;**작성 스타일**: 친근하고 생동감 있는 문체&#10;**글 구조**:&#10;1. 흥미로운 도입부&#10;2. 여행지 특징과 분위기&#10;3. 실용적인 여행 정보&#10;4. 개인적인 경험과 감상&#10;5. 유용한 팁과 주의사항&#10;&#10;**톤**: 친근하고 따뜻한&#10;**형식**: 마크다운&#10;**분량**: 2000-3000자"
                        style="width: 100%; font-family: monospace; font-size: 14px; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; resize: vertical; line-height: 1.6;"
                    ></textarea>
                </div>

                <div class="setting-item">
                    <label>프롬프트 프리셋</label>
                    <div class="description" style="margin-bottom: 10px;">자주 사용하는 프롬프트 템플릿을 빠르게 적용합니다.</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="applyPromptPreset('travel')">
                            여행 블로그
                        </button>
                        <button class="btn btn-secondary" onclick="applyPromptPreset('vlog')">
                            브이로그 리뷰
                        </button>
                        <button class="btn btn-secondary" onclick="applyPromptPreset('info')">
                            정보성 콘텐츠
                        </button>
                        <button class="btn btn-secondary" onclick="applyPromptPreset('story')">
                            스토리텔링
                        </button>
                        <button class="btn btn-secondary" onclick="applyPromptPreset('clear')">
                            초기화
                        </button>
                    </div>
                </div>
            </div>

            <!-- 시스템 관리 -->
            <div class="setting-group">
                <h2>🛠️ 시스템 관리</h2>

                <div class="setting-item">
                    <label>데이터베이스 초기화</label>
                    <div class="description" style="margin-bottom: 10px;">모든 영상 데이터를 삭제하고 처음부터 다시 수집합니다.</div>
                    <button class="btn btn-danger" onclick="resetDatabase()">
                        데이터베이스 초기화
                    </button>
                </div>

                <div class="setting-item">
                    <label>즉시 자막 수집</label>
                    <div class="description" style="margin-bottom: 10px;">현재 설정으로 즉시 자막 수집을 실행합니다.</div>
                    <button class="btn btn-secondary" onclick="collectNow()">
                        수집 시작
                    </button>
                </div>

                <div class="setting-item">
                    <label>SHORTS 영상 삭제</label>
                    <div class="description" style="margin-bottom: 10px;">60초 이하의 SHORTS 영상을 모두 삭제합니다. (앞으로 수집도 자동 제외됩니다)</div>
                    <button class="btn btn-danger" onclick="deleteShorts()">
                        ⏭️ SHORTS 영상 삭제
                    </button>
                </div>
            </div>

            <!-- 저장 버튼 -->
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveSettings()">
                    💾 설정 저장
                </button>
                <button class="btn btn-secondary" onclick="loadSettings()">
                    🔄 설정 불러오기
                </button>
            </div>

            <!-- 상태 메시지 -->
            <div id="status-message" class="status-message"></div>
        </div>
    </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // 비밀번호 표시/숨김 토글
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = event.target;

            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = '숨김';
            } else {
                input.type = 'password';
                button.textContent = '표시';
            }
        }

        // 프롬프트 프리셋 정의
        const PROMPT_PRESETS = {
            travel: `당신은 여행 블로그 전문 작가입니다.

**작성 스타일**: 친근하고 생동감 있는 문체로 독자가 현장에 있는 듯한 느낌을 주는 글을 작성합니다.

**글 구조**:
1. 흥미로운 도입부로 독자의 관심을 끌어주세요
2. 여행지의 특징과 분위기를 생생하게 묘사해주세요
3. 실용적인 여행 정보(교통, 맛집, 추천 코스 등)를 포함해주세요
4. 개인적인 경험과 감상을 담아주세요
5. 독자에게 도움이 될 팁이나 주의사항을 언급해주세요

**톤**: 친근하고 따뜻한
**형식**: 마크다운 형식
**분량**: 2000-3000자 내외`,
            vlog: `당신은 브이로그 콘텐츠 전문 리뷰어입니다.

**작성 스타일**: 영상의 하이라이트와 재미 포인트를 잘 짚어내는 경쾌한 문체

**글 구조**:
1. 영상의 전체적인 분위기와 테마 소개
2. 주요 장면과 인상 깊었던 순간들
3. 브이로거의 개성과 촬영 스타일 분석
4. 영상에서 발견한 정보나 팁 정리
5. 시청 추천 및 기대평

**톤**: 활기차고 긍정적인
**형식**: 마크다운 형식
**분량**: 1500-2000자 내외`,
            info: `당신은 정보 전달에 특화된 콘텐츠 작가입니다.

**작성 스타일**: 명확하고 구조화된 정보 전달, 객관적이고 신뢰감 있는 문체

**글 구조**:
1. 핵심 주제와 정보 요약
2. 세부 정보를 논리적 순서로 정리
3. 데이터나 사실 기반 내용 강조
4. 실용적인 활용 방법이나 팁 제공
5. 참고 정보나 추가 리소스 안내

**톤**: 전문적이고 신뢰감 있는
**형식**: 마크다운 형식, 리스트와 헤딩 적극 활용
**분량**: 1500-2500자 내외`,
            story: `당신은 스토리텔링에 능한 감성적인 작가입니다.

**작성 스타일**: 서사적이고 몰입감 있는 문체, 독자의 감정을 움직이는 글쓰기

**글 구조**:
1. 흥미를 끄는 도입부 (장면 묘사 또는 질문)
2. 시간 순서대로 전개되는 경험 서술
3. 감정의 변화와 내적 성찰
4. 인상 깊었던 순간의 디테일 묘사
5. 독자에게 남기고 싶은 메시지

**톤**: 따뜻하고 감성적인, 때로는 유머러스한
**형식**: 마크다운 형식, 단락 구분 명확히
**분량**: 2000-3000자 내외`
        };

        // 프롬프트 프리셋 적용
        function applyPromptPreset(presetName) {
            const textarea = document.getElementById('blog-prompt-template');

            if (presetName === 'clear') {
                textarea.value = '';
                showStatus('프롬프트 템플릿이 초기화되었습니다.', 'success');
            } else if (PROMPT_PRESETS[presetName]) {
                textarea.value = PROMPT_PRESETS[presetName];
                showStatus(`"${getPresetDisplayName(presetName)}" 프리셋이 적용되었습니다.`, 'success');
            }
        }

        // 프리셋 표시 이름
        function getPresetDisplayName(presetName) {
            const names = {
                travel: '여행 블로그',
                vlog: '브이로그 리뷰',
                info: '정보성 콘텐츠',
                story: '스토리텔링'
            };
            return names[presetName] || presetName;
        }

        // 설정 불러오기
        async function loadSettings() {
            try {
                // LocalStorage에서 설정 불러오기
                const settings = JSON.parse(localStorage.getItem('rubberdog-settings') || '{}');

                if (settings.autoCollect !== undefined) document.getElementById('auto-collect').checked = settings.autoCollect;
                if (settings.collectInterval) document.getElementById('collect-interval').value = settings.collectInterval;
                if (settings.minSubtitleTarget) document.getElementById('min-subtitle-target').value = settings.minSubtitleTarget;
                if (settings.searchKeywords) document.getElementById('search-keywords').value = settings.searchKeywords;
                if (settings.channelLimit) document.getElementById('channel-limit').value = settings.channelLimit;
                if (settings.claudeModel) document.getElementById('claude-model').value = settings.claudeModel;
                if (settings.blogPromptTemplate !== undefined) document.getElementById('blog-prompt-template').value = settings.blogPromptTemplate;

                showStatus('설정을 불러왔습니다.', 'success');
            } catch (error) {
                showStatus('설정을 불러오는데 실패했습니다.', 'error');
            }
        }

        // 설정 저장
        function saveSettings() {
            const settings = {
                autoCollect: document.getElementById('auto-collect').checked,
                collectInterval: document.getElementById('collect-interval').value,
                minSubtitleTarget: document.getElementById('min-subtitle-target').value,
                searchKeywords: document.getElementById('search-keywords').value,
                channelLimit: document.getElementById('channel-limit').value,
                claudeModel: document.getElementById('claude-model').value,
                blogPromptTemplate: document.getElementById('blog-prompt-template').value
            };

            localStorage.setItem('rubberdog-settings', JSON.stringify(settings));
            showStatus('설정이 저장되었습니다.', 'success');
        }

        // 데이터베이스 초기화
        async function resetDatabase() {
            if (!confirm('정말로 모든 영상 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                return;
            }

            if (!confirm('한 번 더 확인합니다. 모든 데이터가 삭제됩니다.')) {
                return;
            }

            showStatus('데이터베이스 초기화 중...', 'success');

            // TODO: 서버 API 호출
            setTimeout(() => {
                showStatus('데이터베이스가 초기화되었습니다.', 'success');
            }, 2000);
        }

        // 즉시 수집 시작
        async function collectNow() {
            if (!confirm('자막 수집을 즉시 시작하시겠습니까?\n\n최대 5개 채널, 각 채널당 최근 10개 영상의 자막을 수집합니다.\n(약 1-2분 소요)')) {
                return;
            }

            showStatus('자막 수집 중... 잠시만 기다려주세요.', 'success');

            try {
                const response = await fetch('/api/admin/trigger-collection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    const summary = result.summary || result;
                    let message = '✅ 자막 수집이 완료되었습니다!<br><br>';
                    message += `<strong>📊 수집 결과:</strong><br>`;
                    message += `• 처리된 채널: ${summary.channelsProcessed || 0}개<br>`;
                    message += `• 수집된 영상: ${summary.totalVideos || 0}개<br>`;
                    message += `• 수집된 자막: ${summary.subtitlesCollected || 0}개<br>`;
                    message += `• 자막 없음: ${summary.noSubtitle || 0}개<br>`;
                    message += `• 소요 시간: ${summary.duration ? summary.duration.toFixed(1) : 0}초`;

                    showStatus(message, 'success');
                } else {
                    showStatus(`❌ 자막 수집 실패: ${result.error || '알 수 없는 오류'}`, 'error');
                }
            } catch (error) {
                console.error('자막 수집 오류:', error);
                showStatus(`❌ 자막 수집 중 오류가 발생했습니다: ${error.message}`, 'error');
            }
        }

        // SHORTS 영상 삭제
        async function deleteShorts() {
            if (!confirm('60초 이하의 SHORTS 영상을 모두 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없으며, 앞으로도 SHORTS는 자동으로 제외됩니다.')) {
                return;
            }

            try {
                showStatus('🔍 SHORTS 영상 검색 중...', 'info');

                const response = await fetch('/api/videos/delete-shorts', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    let message = `✅ ${result.deletedCount}개의 SHORTS 영상이 삭제되었습니다.`;

                    if (result.deletedSamples && result.deletedSamples.length > 0) {
                        message += '\n\n삭제된 영상 예시:\n';
                        result.deletedSamples.slice(0, 5).forEach(v => {
                            message += `\n- ${v.title} (${v.seconds}초)`;
                        });
                    }

                    alert(message);
                    showStatus(`✅ ${result.deletedCount}개의 SHORTS 영상이 삭제되었습니다.`, 'success');
                } else {
                    showStatus(`❌ SHORTS 삭제 실패: ${result.error || '알 수 없는 오류'}`, 'error');
                }
            } catch (error) {
                console.error('SHORTS 삭제 오류:', error);
                showStatus(`❌ SHORTS 삭제 중 오류가 발생했습니다: ${error.message}`, 'error');
            }
        }

        // 상태 메시지 표시
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.innerHTML = message;
            statusDiv.className = `status-message ${type}`;
            statusDiv.style.display = 'block';

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 8000);
        }

        // 페이지 로드시 설정 불러오기
        loadSettings();
    </script>
</body>
</html>
